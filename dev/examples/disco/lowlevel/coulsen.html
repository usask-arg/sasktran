<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Producing the Coulsen Tables with the Low-Level Interface &mdash; SASKTRAN 1.8.1+2.g0944a46 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/sasktran-favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/documentation_options.js?v=cfaf87bc"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configuration" href="../../../config.html" />
    <link rel="prev" title="Polarized Calculations" href="../vector.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/sasktran-light.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.8.1+2.g0944a46
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installing.html">Installing SASKTRAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../constructing_atmosphere.html">Specifying the Atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../constructing_geometry.html">Constructing the Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other_engines.html">Choosing an Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_aerosol.html">Specifying Aerosol</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../climatology_examples.html">Climatology Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../brdf_examples.html">BRDF Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opticalproperty_examples.html">Optical Property Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../geometry_examples.html">Geometry Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hr_examples.html">SASKTRAN-HR Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mc_examples.html">SASKTRAN-MC Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tir_examples.html">SASKTRAN-TIR Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../do_examples.html">SASKTRAN-DO Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../basic_radtran.html">Basic Radiative Transfer Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic_wfcalc.html">Calculating Weighting Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multi_species_wf.html">Multiple Species Weighting Function Calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spherical_corrections.html">Spherical Corrections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vector.html">Polarized Calculations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Producing the Coulsen Tables with the Low-Level Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../experimental.html">Experimental Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sasktran_hr.html">SASKTRAN-HR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tir/index.html">SASKTRAN Thermal InfraRed Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../do/index.html">SASKTRAN-DO</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SASKTRAN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../examples.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../../do_examples.html">SASKTRAN-DO Examples</a></li>
      <li class="breadcrumb-item active">Producing the Coulsen Tables with the Low-Level Interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/examples/disco/lowlevel/coulsen.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Producing-the-Coulsen-Tables-with-the-Low-Level-Interface">
<h1>Producing the Coulsen Tables with the Low-Level Interface<a class="headerlink" href="#Producing-the-Coulsen-Tables-with-the-Low-Level-Interface" title="Link to this heading">Â¶</a></h1>
<p>In this example we will reproduce part of the Coulsen tables using the low level interface to SASKTRAN DO. These tables involve a single layer conservative scattering atmosphere with a Lambertian surface underneath.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">sasktran.disco.lowlevel</span> <span class="k">as</span> <span class="nn">lowlevel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<p>We can begin by setting up our configuration, we are performing a single calculation for 3 stokes parameters, a single layer, and we will set the number of streams to be a high number (40). We will explicitly disable the pseudo spherical correction since these tables correspond to a plane parallel atmosphere. For brevity we will only calculate 6 of the entries in the table.</p>
<p>We start by creating all of the low level input objects.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nstr</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">nlyr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nwavel</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nderiv</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nstokes</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">nlos</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">lowlevel</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">nstr</span><span class="p">,</span> <span class="n">nwavel</span><span class="p">,</span> <span class="n">nlyr</span><span class="p">,</span> <span class="n">nstokes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_pseudo_spherical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">weightingfunctions</span> <span class="o">=</span> <span class="n">lowlevel</span><span class="o">.</span><span class="n">WeightingFunctions</span><span class="p">(</span><span class="n">nstr</span><span class="p">,</span> <span class="n">nlos</span><span class="p">,</span> <span class="n">nstokes</span><span class="p">,</span> <span class="n">nwavel</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">)</span>
<span class="n">viewing_geometry</span> <span class="o">=</span> <span class="n">lowlevel</span><span class="o">.</span><span class="n">ViewingGeometry</span><span class="p">(</span><span class="n">nlos</span><span class="p">)</span>
<span class="n">atmosphere</span> <span class="o">=</span> <span class="n">lowlevel</span><span class="o">.</span><span class="n">Atmosphere</span><span class="p">(</span><span class="n">nstr</span><span class="p">,</span> <span class="n">nlyr</span><span class="p">,</span> <span class="n">nwavel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next letâs setup our viewing geometry. We have to be slightly careful, DO uses the same definition of cosine solar zenith angle <span class="math notranslate nohighlight">\(\mu_0\)</span> (cos_sza), and viewing cosine zenith <span class="math notranslate nohighlight">\(\mu\)</span> (cos_vza), however we have a minus sign convention difference on relative azimuth angle <span class="math notranslate nohighlight">\(\phi\)</span> (saa).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_sza</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.00</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">cos_vza</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.00</span>

<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
<span class="n">viewing_geometry</span><span class="o">.</span><span class="n">saa</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
</pre></div>
</div>
</div>
<p>And finally our atmosphere optical quantities. The table is for a single layer of optical depth 0.5 and single scatter albedo of 1. The table contains only Rayleigh scattering with no depolarization factor, of which the Legendre coefficients are easy to calculate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atmosphere</span><span class="o">.</span><span class="n">od</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">atmosphere</span><span class="o">.</span><span class="n">ssa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">atmosphere</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">atmosphere</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">atmosphere</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">atmosphere</span><span class="o">.</span><span class="n">a4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span>

<span class="n">atmosphere</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
<p>Next we set the albedo to 0</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atmosphere</span><span class="o">.</span><span class="n">albedo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
<p>And finally, even though the layer boundary altitudes are not used in this problem, we set it to an arbitrary number for good measure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atmosphere</span><span class="o">.</span><span class="n">layer_boundary_altitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
</pre></div>
</div>
</div>
<p>Next we perform the calculation and multiply by <span class="math notranslate nohighlight">\(\pi\)</span> since the tables assume a solar flux of <span class="math notranslate nohighlight">\(\pi\)</span> while DO assumes a solar flux of 1.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">lowlevel</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">atmosphere</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">weightingfunctions</span><span class="p">,</span> <span class="n">viewing_geometry</span><span class="p">)</span><span class="o">.</span><span class="n">xarray</span><span class="p">()</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;radiance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
</div>
<p>We can print the first element of the stokes vectorâs and see that they are the same as those in the table to ~4 decimal places.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">stokes</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;radiance&#39; (los: 6)&gt;
array([0.44129254, 0.2693917 , 0.05300537, 0.30090663, 0.19367869,
       0.05300537])
Dimensions without coordinates: los
</pre></div></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../vector.html" class="btn btn-neutral float-left" title="Polarized Calculations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../config.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ARG University of Saskatchewan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>