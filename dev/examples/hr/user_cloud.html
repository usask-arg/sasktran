<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the Baum Ice Crystal Database with HR &mdash; SASKTRAN 0+unknown documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/sasktran-favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SASKTRAN-MC Examples" href="../mc_examples.html" />
    <link rel="prev" title="Calculating optical depths along lines of sight in HR" href="cell_opticaldepths.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/sasktran-light.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0+unknown
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installing SASKTRAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../constructing_atmosphere.html">Specifying the Atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../constructing_geometry.html">Constructing the Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other_engines.html">Choosing an Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_aerosol.html">Specifying Aerosol</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../climatology_examples.html">Climatology Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../brdf_examples.html">BRDF Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opticalproperty_examples.html">Optical Property Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry_examples.html">Geometry Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../hr_examples.html">SASKTRAN-HR Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic_radtran.html">Basic Radiative Transfer Calculation with HR</a></li>
<li class="toctree-l3"><a class="reference internal" href="polarized_calculation.html">Polarized Radiative Transfer Calculation with HR</a></li>
<li class="toctree-l3"><a class="reference internal" href="onedim_wf.html">Calculating Weighting Functions with HR</a></li>
<li class="toctree-l3"><a class="reference internal" href="single_scatter.html">Single Scatter in HR</a></li>
<li class="toctree-l3"><a class="reference internal" href="diagnostic.html">Collecting diagnostic data during radiative transfer calculation with HR</a></li>
<li class="toctree-l3"><a class="reference internal" href="cell_opticaldepths.html">Calculating optical depths along lines of sight in HR</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using the Baum Ice Crystal Database with HR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Setting-the-model-parameters">Setting the model parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mc_examples.html">SASKTRAN-MC Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../experimental.html">Experimental Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sasktran_hr.html">SASKTRAN-HR</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SASKTRAN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../examples.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../hr_examples.html">SASKTRAN-HR Examples</a></li>
      <li class="breadcrumb-item active">Using the Baum Ice Crystal Database with HR</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/hr/user_cloud.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Using-the-Baum-Ice-Crystal-Database-with-HR">
<h1>Using the Baum Ice Crystal Database with HR<a class="headerlink" href="#Using-the-Baum-Ice-Crystal-Database-with-HR" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sasktran</span> <span class="k">as</span> <span class="nn">sk</span>
</pre></div>
</div>
</div>
<p>SASKTRAN supports calculations using the Baum ice crystal database.  The core of this functionality is contained within the <a class="reference internal" href="../../optical_property.html#sasktran.BaumIceCrystal" title="sasktran.BaumIceCrystal"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaumIceCrystal</span></code></a> optical property.  In principle including ice crystals is as simple as creating a climatology to go along with the optical property and adding it to the engine, however complications involving the radiative transfer of ice clouds usually means that the HR engine must be configured in a specific way to obtain accurate calculations.</p>
<p>The <a class="reference internal" href="../../species.html#sasktran.SpeciesBaumIceCloud" title="sasktran.SpeciesBaumIceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpeciesBaumIceCloud</span></code></a> species combines the <a class="reference internal" href="../../optical_property.html#sasktran.BaumIceCrystal" title="sasktran.BaumIceCrystal"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaumIceCrystal</span></code></a> optical property with a climatology that creates a Gaussian shaped cloud with a specified size and optical thickness.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baum_species</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">SpeciesBaumIceCloud</span><span class="p">(</span><span class="n">particlesize_microns</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                      <span class="n">cloud_top_m</span><span class="o">=</span><span class="mi">16500</span><span class="p">,</span>
                                      <span class="n">cloud_width_fwhm_m</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                                      <span class="n">vertical_optical_depth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                      <span class="n">vertical_optical_depth_wavel_nm</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">OSError</span>                                   Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[2], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> baum_species <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">sk</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">SpeciesBaumIceCloud</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">particlesize_microns</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">20</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">cloud_top_m</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">16500</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">cloud_width_fwhm_m</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">500</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">vertical_optical_depth</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.01</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">vertical_optical_depth_wavel_nm</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">750</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/share/miniconda/envs/doc_env/lib/python3.9/site-packages/sasktran/species.py:253</span>, in <span class="ansi-cyan-fg">SpeciesBaumIceCloud.__init__</span><span class="ansi-blue-fg">(self, particlesize_microns, cloud_top_m, cloud_width_fwhm_m, vertical_optical_depth, vertical_optical_depth_wavel_nm, altitude_resolution_m, num_sigma, name)</span>
<span class="ansi-green-intense-fg ansi-bold">    249</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__init__</span>(<span style="color: rgb(0,135,0)">self</span>, particlesize_microns: <span style="color: rgb(0,135,0)">float</span>, cloud_top_m: <span style="color: rgb(0,135,0)">float</span>,
<span class="ansi-green-intense-fg ansi-bold">    250</span>              cloud_width_fwhm_m: <span style="color: rgb(0,135,0)">float</span>, vertical_optical_depth: <span style="color: rgb(0,135,0)">float</span>,
<span class="ansi-green-intense-fg ansi-bold">    251</span>              vertical_optical_depth_wavel_nm: <span style="color: rgb(0,135,0)">float</span>, altitude_resolution_m: <span style="color: rgb(0,135,0)">float</span><span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">10</span>, num_sigma: <span style="color: rgb(0,135,0)">int</span><span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">5</span>,
<span class="ansi-green-intense-fg ansi-bold">    252</span>              name<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">icecloud</span><span style="color: rgb(175,0,0)">&#39;</span>):
<span class="ansi-green-fg">--&gt; 253</span>     optical_property <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">sk</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">BaumIceCrystal</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">particlesize_microns</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    255</span>     cloud_sigma <span style="color: rgb(98,98,98)">=</span> cloud_width_fwhm_m <span style="color: rgb(98,98,98)">/</span> (<span style="color: rgb(98,98,98)">2</span> <span style="color: rgb(98,98,98)">*</span> np<span style="color: rgb(98,98,98)">.</span>sqrt(<span style="color: rgb(98,98,98)">2</span> <span style="color: rgb(98,98,98)">*</span> np<span style="color: rgb(98,98,98)">.</span>log(<span style="color: rgb(98,98,98)">2</span>)))
<span class="ansi-green-intense-fg ansi-bold">    257</span>     <span style="color: rgb(95,135,135)"># Cloud top is defined as middle + 2 sigma</span>

File <span class="ansi-green-fg">/usr/share/miniconda/envs/doc_env/lib/python3.9/site-packages/sasktran/opticalproperty.py:838</span>, in <span class="ansi-cyan-fg">BaumIceCrystal.__init__</span><span class="ansi-blue-fg">(self, effective_size_microns, use_delta_eddington)</span>
<span class="ansi-green-intense-fg ansi-bold">    836</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__init__</span>(<span style="color: rgb(0,135,0)">self</span>, effective_size_microns, use_delta_eddington<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>):
<span class="ansi-green-intense-fg ansi-bold">    837</span>     <span style="color: rgb(0,135,0)">super</span>()<span style="color: rgb(98,98,98)">.</span><span style="color: rgb(0,0,255)">__init__</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">BAUM_ICECRYSTALS</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">--&gt; 838</span>     <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_validate_registry</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    840</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_effective_size_microns <span style="color: rgb(98,98,98)">=</span> effective_size_microns
<span class="ansi-green-intense-fg ansi-bold">    841</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_use_delta_eddington <span style="color: rgb(98,98,98)">=</span> use_delta_eddington

File <span class="ansi-green-fg">/usr/share/miniconda/envs/doc_env/lib/python3.9/site-packages/sasktran/opticalproperty.py:865</span>, in <span class="ansi-cyan-fg">BaumIceCrystal._validate_registry</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    863</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>isfile(os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>join(baum_folder, <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">GeneralHabitMixture_SeverelyRough_AllWavelengths_FullPhaseMatrix.nc</span><span style="color: rgb(175,0,0)">&#39;</span>)):
<span class="ansi-green-intense-fg ansi-bold">    864</span>     user_config <span style="color: rgb(98,98,98)">=</span> config<span style="color: rgb(98,98,98)">.</span>user_config_file_location()
<span class="ansi-green-fg">--&gt; 865</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">IOError</span>(
<span class="ansi-green-intense-fg ansi-bold">    866</span>         <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Baum Folder is invalid, please add baum_directory: xxxx to the file </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(98,98,98)">.</span>format(user_config))

<span class="ansi-red-fg">OSError</span>: Baum Folder is invalid, please add baum_directory: xxxx to the file /home/runner/.config/sasktran/config.yml
</pre></div></div>
</div>
<p>Which creates a cloud species that consists of 20 micron sized particles, a cloud top altitude of 16.5 km, a full width at half maximum in altitude of 500 m, and has a vertical optical depth of 0.01 at 750 nm.  Note that limb path lengths can be ~100 times that of vertical path lengths, so even a vertically thin cloud may appear thick in the limb geometry.  Shown below is the calculated Gaussian number density.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">altitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">cloud_dens</span> <span class="o">=</span> <span class="n">baum_species</span><span class="o">.</span><span class="n">climatology</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;icecloud&#39;</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="mi">54372</span><span class="p">,</span> <span class="n">altitudes</span><span class="o">=</span><span class="n">altitudes</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cloud_dens</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altitude [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number Density [/cm3]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[3], line 3</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> altitudes <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>arange(<span style="color: rgb(98,98,98)">10000</span>, <span style="color: rgb(98,98,98)">20000</span>, <span style="color: rgb(98,98,98)">10</span>)
<span class="ansi-green-fg">----&gt; 3</span> cloud_dens <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">baum_species</span><span style="color: rgb(98,98,98)">.</span>climatology<span style="color: rgb(98,98,98)">.</span>get_parameter(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">icecloud</span><span style="color: rgb(175,0,0)">&#39;</span>, latitude<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0</span>, longitude<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0</span>, mjd<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">54372</span>, altitudes<span style="color: rgb(98,98,98)">=</span>altitudes)
<span class="ansi-green-intense-fg ansi-bold">      5</span> plt<span style="color: rgb(98,98,98)">.</span>plot(cloud_dens, altitudes)
<span class="ansi-green-intense-fg ansi-bold">      6</span> plt<span style="color: rgb(98,98,98)">.</span>ylabel(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Altitude [m]</span><span style="color: rgb(175,0,0)">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;baum_species&#39; is not defined
</pre></div></div>
</div>
<p>We can now set up the HR engine and add the species to it as we would any other species.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tanalts_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># First recreate our geometry and atmosphere classes</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">VerticalImage</span><span class="p">()</span>
<span class="n">geometry</span><span class="o">.</span><span class="n">from_sza_saa</span><span class="p">(</span><span class="n">sza</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">saa</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tanalts_km</span><span class="o">=</span><span class="n">tanalts_km</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="mi">54372</span><span class="p">,</span> <span class="n">locallook</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">satalt_km</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">refalt_km</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">atmosphere</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">Atmosphere</span><span class="p">()</span>

<span class="n">atmosphere</span><span class="p">[</span><span class="s1">&#39;ozone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">Species</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">O3OSIRISRes</span><span class="p">(),</span> <span class="n">sk</span><span class="o">.</span><span class="n">Labow</span><span class="p">())</span>
<span class="n">atmosphere</span><span class="p">[</span><span class="s1">&#39;air&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">Species</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">Rayleigh</span><span class="p">(),</span> <span class="n">sk</span><span class="o">.</span><span class="n">MSIS90</span><span class="p">())</span>
<span class="n">atmosphere</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baum_species</span>

<span class="c1"># And now make the engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">EngineHR</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">atmosphere</span><span class="o">=</span><span class="n">atmosphere</span><span class="p">)</span>

<span class="c1"># Choose some wavelengths to do the calculation at</span>
<span class="n">engine</span><span class="o">.</span><span class="n">wavelengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">340</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[4], line 12</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span> atmosphere[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">ozone</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">=</span> sk<span style="color: rgb(98,98,98)">.</span>Species(sk<span style="color: rgb(98,98,98)">.</span>O3OSIRISRes(), sk<span style="color: rgb(98,98,98)">.</span>Labow())
<span class="ansi-green-intense-fg ansi-bold">     11</span> atmosphere[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">air</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">=</span> sk<span style="color: rgb(98,98,98)">.</span>Species(sk<span style="color: rgb(98,98,98)">.</span>Rayleigh(), sk<span style="color: rgb(98,98,98)">.</span>MSIS90())
<span class="ansi-green-fg">---&gt; 12</span> atmosphere[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">cloud</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">baum_species</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span style="color: rgb(95,135,135)"># And now make the engine</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span> engine <span style="color: rgb(98,98,98)">=</span> sk<span style="color: rgb(98,98,98)">.</span>EngineHR(geometry<span style="color: rgb(98,98,98)">=</span>geometry, atmosphere<span style="color: rgb(98,98,98)">=</span>atmosphere)

<span class="ansi-red-fg">NameError</span>: name &#39;baum_species&#39; is not defined
</pre></div></div>
</div>
<p>But before we run the calculation we should modify some settings in the engine to account for the cloud accurately.</p>
<section id="Setting-the-model-parameters">
<h2>Setting the model parameters<a class="headerlink" href="#Setting-the-model-parameters" title="Permalink to this heading">¶</a></h2>
<p>The default vertical resolution of SASKTRAN-HR is ~1000 m, however clouds typically have fine structures and the cloud included above is calculated at a 10 m resolution by default.  We could set the grid spacing of HR to be 10 m, however this would result in a very slow calculation.  It also is not necessary because the cloud is localized over a few km, we do not need 10 m resolution throughout the entire atmosphere.  There are also several settings related to the adaptive integration of rays that should be used when including clouds.  For convenience the <a class="reference internal" href="../../engine.html#sasktran.EngineHR.configure_for_cloud" title="sasktran.EngineHR.configure_for_cloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">configure_for_cloud</span></code></a> method will set most of these things.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">configure_for_cloud</span><span class="p">(</span><span class="n">cloud_altitudes</span><span class="o">=</span><span class="n">baum_species</span><span class="o">.</span><span class="n">altitude_grid</span><span class="p">,</span> <span class="n">grid_spacing_m</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">rad</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">calculate_radiance</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rad</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">tanalts_km</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altitude [km]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Radiance&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[5], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">engine</span><span style="color: rgb(98,98,98)">.</span>configure_for_cloud(cloud_altitudes<span style="color: rgb(98,98,98)">=</span>baum_species<span style="color: rgb(98,98,98)">.</span>altitude_grid, grid_spacing_m<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">1000</span>)
<span class="ansi-green-intense-fg ansi-bold">      3</span> rad <span style="color: rgb(98,98,98)">=</span> engine<span style="color: rgb(98,98,98)">.</span>calculate_radiance()
<span class="ansi-green-intense-fg ansi-bold">      4</span> plt<span style="color: rgb(98,98,98)">.</span>plot(rad<span style="color: rgb(98,98,98)">.</span>T, tanalts_km)

<span class="ansi-red-fg">NameError</span>: name &#39;engine&#39; is not defined
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cell_opticaldepths.html" class="btn btn-neutral float-left" title="Calculating optical depths along lines of sight in HR" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../mc_examples.html" class="btn btn-neutral float-right" title="SASKTRAN-MC Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ARG University of Saskatchewan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>