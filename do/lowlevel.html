<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; SASKTRAN 1.8.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/sasktran-favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="The Low Level Interface to SASKTRAN-DO" href="lowlevelmain.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/sasktran-light.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.8.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing SASKTRAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constructing_atmosphere.html">Specifying the Atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constructing_geometry.html">Constructing the Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other_engines.html">Choosing an Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_aerosol.html">Specifying Aerosol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experimental.html">Experimental Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../sasktran_hr.html">SASKTRAN-HR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tir/index.html">SASKTRAN Thermal InfraRed Engine</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">SASKTRAN-DO</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quick_start.html">Sasktran-Disco Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="lowlevelmain.html">The Low Level Interface to SASKTRAN-DO</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#optical-layer-quantities">Optical Layer Quantities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geometry-layer-quantities">Geometry Layer Quantities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#viewing-geometry">Viewing Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#weighting-function-specification">Weighting Function Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#computational-considerations">Computational Considerations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SASKTRAN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">SASKTRAN-DO</a></li>
          <li class="breadcrumb-item"><a href="lowlevelmain.html">The Low Level Interface to SASKTRAN-DO</a></li>
      <li class="breadcrumb-item active">Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/do/lowlevel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overview">
<span id="lowlevel"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>In addition to being part of the standard SASKTRAN framework, SASKTRAN-DO exposes a secondary interface
that we colloquially refer to as the low-level interface.  The low-level interface has the potential to be
faster and allow for more generic calculations, as the cost of increased complexity in setting it up.  Instead
of supplying high level constructs to the model like climatologies (number densities) and optical properties (cross sections
and phase functions), the user directly supplies low-level constructs like layer optical depth, layer single scatter albedo, and layer
Legendre coefficients.  Constructing these quantities requires significantly more developer effort and is only recommended
for advanced users who are experienced in radiative transfer.</p>
<p>The input to the low-level interface is four structures:</p>
<ul class="simple">
<li><p>An <a class="reference internal" href="api.html#sasktran.disco.lowlevel.Atmosphere" title="sasktran.disco.lowlevel.Atmosphere"><code class="xref py py-class docutils literal notranslate"><span class="pre">sasktran.disco.lowlevel.Atmosphere</span></code></a> object which defines the layer optical depths, single scatter albedos, legendre coefficients, and other aspects to do with the layering.</p></li>
<li><p>An <code class="xref py py-class docutils literal notranslate"><span class="pre">sasktran.disco.lowlevel.Config</span></code> object which sets some configuration settings</p></li>
<li><p>An <code class="xref py py-class docutils literal notranslate"><span class="pre">sasktran.disco.lowlevel.ViewingGeometry</span></code> object which specifies the viewing geometry</p></li>
<li><p>Optionally a <code class="xref py py-class docutils literal notranslate"><span class="pre">sasktran.disco.lowlevel.WeightingFunctions</span></code> object to specify which quantities to calculate derivatives with respect to.</p></li>
</ul>
<p>Radiative transfer is performed through a single function call,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">sasktran.disco.lowlevel.calculate()</span></code>. We have found that the notation and definitions of various
radiative transfer quantities are rarely consistent, and as such the following sections
briefly outline
the theory of the discrete ordinates technique with a focus on how to define the necessary inputs
for the model. For details on how to construct these inputs in code, we recommend reviewing the API reference for
the input and output structures, and looking at some of the examples.</p>
<section id="optical-layer-quantities">
<h2>Optical Layer Quantities<a class="headerlink" href="#optical-layer-quantities" title="Permalink to this heading">¶</a></h2>
<p>DO performs radiative transfer through a medium consisting of <span class="math notranslate nohighlight">\(N_{lyr}\)</span> optically homogeneous
layers.  We use the index <span class="math notranslate nohighlight">\(i\)</span> to index over each layer, <span class="math notranslate nohighlight">\(i=0\)</span> always corresponds to the
layer at the Top of the Atmosphere (TOA), while <span class="math notranslate nohighlight">\(i=N_{lyr}-1\)</span> is the layer touching the surface
of the Earth.  Optically each layer is defined by its vertical optical depth, <span class="math notranslate nohighlight">\(\Delta_i\)</span>, single scatter albedo,
<span class="math notranslate nohighlight">\(\omega_i\)</span>, and scattering Legendre coefficients, <span class="math notranslate nohighlight">\(\vec{\beta}_{i,l}\)</span>.  The index
<span class="math notranslate nohighlight">\(l\)</span> runs from <span class="math notranslate nohighlight">\(0 \ldots N_{str}-1\)</span>, resulting in a second user defined configuration option,
<span class="math notranslate nohighlight">\(N_{str}\)</span> that influences the accuracy of the calculation.</p>
<p>The Legendre coefficient vector is defined in terms of the phase matrix.  Suppressing
the layer index for now,
in generalized form the phase
matrix takes the shape,</p>
<div class="math notranslate nohighlight">
\[\begin{split}P(\Theta) = \begin{pmatrix}
                P_{11}(\Theta) &amp; P_{12}(\Theta) &amp; 0 &amp; 0 \\
                P_{12}(\Theta) &amp; P_{22}(\Theta) &amp; 0 &amp; 0 \\
                0 &amp; 0 &amp; P_{33}(\Theta) &amp; P_{34}(\Theta) \\
                0 &amp; 0 &amp; -P_{34}(\Theta) &amp; P_{44}(\Theta)
            \end{pmatrix}\end{split}\]</div>
<p>The phase matrix elements are then expanded in terms of Wigner functions (generalized spherical
functions related to Legendre polynomials/associated Legendre functions)</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}P_{11}(\Theta) = \sum_l a_{1, l} \, d^l_{00}(\Theta)\\P_{22}(\Theta) + P_{33}(\Theta) = \sum_l (a_{2, l} + a_{3, l}) \, d^l_{2,2}(\Theta)\\P_{22}(\Theta) - P_{33}(\Theta) = \sum_l (a_{2, l} - a_{3, l}) \, d^l_{2,-2}(\Theta)\\P_{44}(\Theta) = \sum_l a_{4, l} \, d^l_{00}(\Theta)\\P_{12}(\Theta) = \sum_l b_{1, l} \, d^l_{02}(\Theta)\\P_{34}(\Theta) = -\sum_l b_{2, l} \, d^l_{02}(\Theta)\end{aligned}\end{align} \]</div>
<p>The set of 6 coefficients, <span class="math notranslate nohighlight">\(\vec{\beta}_l = (a_{1, l}, a_{2,l}, a_{3,l}, a_{4,l}, b_{1,l}, b_{2,l})\)</span> then
are the necessary inputs to the model. Note that in the scalar approximation (<span class="math notranslate nohighlight">\(N_{stokes}=1\)</span>), we
assume every coefficient except for <span class="math notranslate nohighlight">\(a_{1,l}\)</span> is zero, and thus only the <span class="math notranslate nohighlight">\(a_{1,l}\)</span> coefficients
are necessary for input. The <cite>pysasktran</cite> package includes functionality to calculate Wigner functions
and also calculate the necessary coefficients if you only have the phase function.</p>
<section id="delta-scaling">
<h3>Delta Scaling<a class="headerlink" href="#delta-scaling" title="Permalink to this heading">¶</a></h3>
<p>DO includes the option to include a delta-scaling factor for the phase function.</p>
</section>
<section id="single-scatter-correction">
<h3>Single Scatter Correction<a class="headerlink" href="#single-scatter-correction" title="Permalink to this heading">¶</a></h3>
<p>DO implements the TMS correction which replaces the single scatter solution with an exact single scatter calculation.
In this case the first row of the phase matrix <span class="math notranslate nohighlight">\(\vec{P}\)</span> must be specified for each viewing geometry.  Note that
currently this option only works in scalar mode.</p>
</section>
</section>
<section id="geometry-layer-quantities">
<h2>Geometry Layer Quantities<a class="headerlink" href="#geometry-layer-quantities" title="Permalink to this heading">¶</a></h2>
<p>To further define the problem we need to specify a few quantities that are purely geometry dependent.
These are:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Earth Radius</p></li>
<li><p>The altitude (relative to the Earth radius) of each boundary separating the layer</p></li>
</ul>
</div></blockquote>
<p>These quantities are used for spherical approximations within the model, and to determine the location
of the observer inside the atmosphere. If all spherical approximations are turned
off and the observer is outside the atmosphere they are not used.</p>
</section>
<section id="viewing-geometry">
<h2>Viewing Geometry<a class="headerlink" href="#viewing-geometry" title="Permalink to this heading">¶</a></h2>
<p>The viewing geometry for DO is specified in terms of viewing angles and solar angles.</p>
<blockquote>
<div><ul class="simple">
<li><p>The cosine of viewing zenith angle: defined such that <cite>cos_vza=0</cite> corresponds to true Nadir viewing</p></li>
<li><p>The cosine of solar zenith angle: defined such that <cite>cos_sza=0</cite> corresponds to the sun directly overhead</p></li>
<li><p>Relative solar azimuth angle: defined as the relative azimuth angle in radians between the observer and solar direction such that <cite>saa=0</cite> is the backwards scattering direction.</p></li>
<li><p>Observer altitude: the altitude of the observer relative to the Earth radius, can be set to -1 to indicate that the observer is outside the atmosphere.</p></li>
</ul>
</div></blockquote>
<p>Currently the only way to specify the viewing geometry for DO is as a list of <cite>(cos_vza, saa, altitude)</cite> triplets, with a single
<cite>cos_sza</cite>.</p>
</section>
<section id="weighting-function-specification">
<h2>Weighting Function Specification<a class="headerlink" href="#weighting-function-specification" title="Permalink to this heading">¶</a></h2>
<p>A key feature of DO is that it is analytically linearized with respect to the optical input quantities, this
includes:</p>
<ul class="simple">
<li><p>Optical depth, <span class="math notranslate nohighlight">\(\Delta\)</span></p></li>
<li><p>Single scatter albedo, <span class="math notranslate nohighlight">\(\omega\)</span></p></li>
<li><p>Legendre phase moments, <span class="math notranslate nohighlight">\(\vec{\beta}_l\)</span></p></li>
<li><p>Delta-truncation factor, <span class="math notranslate nohighlight">\(f\)</span></p></li>
<li><p>Single scattering phase function, <span class="math notranslate nohighlight">\(\vec{P}\)</span></p></li>
<li><p>Surface albedo, <span class="math notranslate nohighlight">\(a\)</span></p></li>
</ul>
<p>Suppose we have a quantity <span class="math notranslate nohighlight">\(x\)</span> that affects some or all of these optical quantities in a single layer <span class="math notranslate nohighlight">\(i\)</span>, we
can write the derivative of radiance with respect to this quantity as,</p>
<div class="math notranslate nohighlight">
\[\frac{\partial I}{\partial x} = \frac{\partial \Delta_i}{\partial x} \frac{\partial I}{\partial \Delta_i} + \frac{\partial \omega_i}{\partial x} \frac{\partial I}{\partial \omega_i} + \sum_l \frac{\partial \vec{\beta}_l}{\partial x} \frac{\partial I}{\partial \vec{\beta}_l} + \frac{\partial \vec{P}_i}{\partial x} \frac{\partial I}{\partial \vec{P}_i} + \frac{\partial a}{\partial x} \frac{\partial I}{\partial a},\]</div>
<p>The quantities on the right hand side that involve the derivative of radiance with respect to a fundamental input quantity
(e.g. <span class="math notranslate nohighlight">\(\partial I / \partial \Delta_i\)</span>) are internally calculated by DO.  The other quantities,
the derivatives of the fundamental input quantities by <span class="math notranslate nohighlight">\(x\)</span> (e.g. <span class="math notranslate nohighlight">\(\partial \Delta_i / \partial x\)</span>) are
inputs to the model.  These input quantities must be computed by the user and are usually a straight-forward application
of differentiation.</p>
<p>Quite often it is desired to calculate a derivative with respect a quantity that affects multiple layers (e.g. a total column derivative).
Currently this involves some manual work by the user.  The user must calculate how this quantity affects every layer
individually, calculate <span class="math notranslate nohighlight">\(N_{lyr}\)</span> derivatives, and then sum them together.</p>
</section>
<section id="computational-considerations">
<h2>Computational Considerations<a class="headerlink" href="#computational-considerations" title="Permalink to this heading">¶</a></h2>
<p>For most applications DO will be called many times with the same layer configuration for multiple sets of optical properties,
for example, the same calculation performed at multiple wavelengths.  For this reason, multiple sets of optical
properties can be input to the model at the same time.  We refer to this dimension as the wavelength dimension, although
it does not necessarily have to correspond to wavelength.  In other words, rather than the layer optical depths
<span class="math notranslate nohighlight">\(\Delta\)</span> being a one-dimensional array of size <span class="math notranslate nohighlight">\((N_{lyr})\)</span>, it is instead a two-dimensional array
of size <span class="math notranslate nohighlight">\((N_{lyr}, N_{wavel})\)</span>.  Every optical quantity has this additional dimension, while the geometry quantities
do not.</p>
<p>Specifying optical properties like this instead of the user looping over
the wavelength dimension is preferable since internally the DO engine can save computational effort by not repeating
any setup that would be common between each calculation.  Furthermore it allows the DO engine to multi-thread
over the wavelength dimension if requested.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lowlevelmain.html" class="btn btn-neutral float-left" title="The Low Level Interface to SASKTRAN-DO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ARG University of Saskatchewan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>