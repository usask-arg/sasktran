<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Topics &mdash; SASKTRAN 1.8.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/_static/theme_overrides.css" />

  
    <link rel="shortcut icon" href="_static/sasktran-favicon.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=82e6e318"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experimental Features" href="experimental.html" />
    <link rel="prev" title="Weighting Functions" href="weighting_functions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/sasktran-light.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.8.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing SASKTRAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="constructing_atmosphere.html">Specifying the Atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="constructing_geometry.html">Constructing the Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_engines.html">Choosing an Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_aerosol.html">Specifying Aerosol</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-sasktranif-like-objects">Creating SasktranIF Like Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-scaling-climatology">Example - Scaling Climatology</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-not-just-make-a-user-defined-climatology">Why Not Just Make a User Defined Climatology?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="experimental.html">Experimental Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sasktran_hr.html">SASKTRAN-HR</a></li>
<li class="toctree-l1"><a class="reference internal" href="tir/index.html">SASKTRAN Thermal InfraRed Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="do/index.html">SASKTRAN-DO</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SASKTRAN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Advanced Topics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/advanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-topics">
<span id="advanced"></span><h1>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">¶</a></h1>
<section id="creating-sasktranif-like-objects">
<h2>Creating SasktranIF Like Objects<a class="headerlink" href="#creating-sasktranif-like-objects" title="Link to this heading">¶</a></h2>
<section id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h3>
<p>Often it is desired to create a new optical property or climatology for a project, but modifying the SasktranIF
internals is not an option.  In the climatology case solution for this kind of problem is to use the UserDefined classes available
to make a climatology for example.  However this has the downside that the created object no longer acts like a
<cite>Climatology</cite>, it is often fixed to an instant in time and location.  With the <cite>sasktran</cite> package we are able to create
pseudo-sasktranif objects where the logic is implemented in Python, but are still able to be used in the same way as
regular <cite>sasktranif</cite> style objects.  This allows a decoupling of the configuration and execution stages.</p>
</section>
<section id="how-it-works">
<h3>How It Works<a class="headerlink" href="#how-it-works" title="Link to this heading">¶</a></h3>
<p>All climatologies, optical properties, etc, that are input to a SASKTRAN engine must still be raw <cite>sasktranif</cite> objects.
However since in the <cite>sasktran</cite> package we operate one level above the raw <cite>sasktranif</cite> interface, only converting
to <cite>ISK</cite> style objects when necessary, we can defer this conversion until the last possible moment, typically right
before the radiative transfer calculation.  At the time of this conversion we ideally have a variety of information
available to us, for example, the wavelengths of the calculation, and the internal model reference point.  Therefore
any class that has information that can be converted into a <cite>sasktranif</cite> base object, such as a <cite>UserDefinedProfile</cite> can
be integrated very closely with the <cite>sasktran</cite> package.</p>
</section>
<section id="example-scaling-climatology">
<h3>Example - Scaling Climatology<a class="headerlink" href="#example-scaling-climatology" title="Link to this heading">¶</a></h3>
<p>As a first example, we will implement a scaling climatology, something which takes in an existing climatology and scales
it by a constant value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sasktran.climatology</span> <span class="kn">import</span> <span class="n">ClimatologyBase</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">ScalingClimatology</span><span class="p">(</span><span class="n">ClimatologyBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_climatology</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_other_climatology</span> <span class="o">=</span> <span class="n">other_climatology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor</span> <span class="o">=</span> <span class="n">scale_factor</span>

    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mjd</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_climatology</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">,</span> <span class="n">mjd</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor</span>

    <span class="k">def</span> <span class="nf">skif_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>All we do is call the other climatology, and scale it by a number.  Let’s try it out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sasktran.climatology</span> <span class="kn">import</span> <span class="n">Labow</span>

<span class="n">other_clim</span> <span class="o">=</span> <span class="n">Labow</span><span class="p">()</span>
<span class="n">scaled_clim</span> <span class="o">=</span> <span class="n">ScalingClimatology</span><span class="p">(</span><span class="n">other_clim</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">other_clim</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;SKCLIMATOLOGY_O3_CM3&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">],</span> <span class="mi">54372</span><span class="p">)</span>
<span class="c1"># array([  4.78059418e+11,   3.66810991e+12])</span>
<span class="n">scaled_clim</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">&#39;SKCLIMATOLOGY_O3_CM3&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">],</span> <span class="mi">54372</span><span class="p">)</span>
<span class="c1"># array([  9.56118837e+11,   7.33621983e+12])</span>
</pre></div>
</div>
<p>Now we have a climatology that we can get parameters out of it, but can we can’t actually use this in a radiative
transfer calculation.  The climatology is passed through to the SASKTRAN engine by using the <cite>skif_object</cite> method,
which we have not yet implemented.  In this function we need to convert our Climatology to a form that SASKTRAN
can use.  This can be done in a variety of ways, but lets take advantage of an existing class, the ClimatologyUserDefined
class. We also need to know what the reference point for the model is, this is where the **kwargs argument saves the day.
All standard engines when calling skif_object will pass a reference to themselves inside the **kwargs argument.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sasktran.climatology</span> <span class="kn">import</span> <span class="n">ClimatologyBase</span><span class="p">,</span> <span class="n">ClimatologyUserDefined</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">ScalingClimatology</span><span class="p">(</span><span class="n">ClimatologyBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_climatology</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_other_climatology</span> <span class="o">=</span> <span class="n">other_climatology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor</span> <span class="o">=</span> <span class="n">scale_factor</span>

    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mjd</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_climatology</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">,</span> <span class="n">mjd</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_factor</span>

    <span class="k">def</span> <span class="nf">skif_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">altitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">clim_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">engine</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
        <span class="n">reference_point</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;referencepoint&#39;</span><span class="p">]</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">reference_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="n">reference_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mjd</span> <span class="o">=</span> <span class="n">reference_point</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_climatology</span><span class="o">.</span><span class="n">supported_species</span><span class="p">():</span>
            <span class="n">clim_values</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">,</span> <span class="n">mjd</span><span class="p">)</span>

        <span class="n">userdef_clim</span> <span class="o">=</span> <span class="n">ClimatologyUserDefined</span><span class="p">(</span><span class="n">altitudes</span><span class="p">,</span> <span class="n">clim_values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">userdef_clim</span><span class="o">.</span><span class="n">skif_object</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we have taken the reference point from the engine right before the radiative transfer calculation is about to happen,
and then we create our climatology dynamically based upon this.  For this example we have hard coded the altitudes in,
however we could also look at the engines option map and figure out what the optical property table altitudes are.
We now have an object where the logic is implemented inside python, but we can still use it the same as any
<cite>sasktranif</cite> climatology object.</p>
<section id="why-not-just-make-a-user-defined-climatology">
<h4>Why Not Just Make a User Defined Climatology?<a class="headerlink" href="#why-not-just-make-a-user-defined-climatology" title="Link to this heading">¶</a></h4>
<p>We could have just as easily make a ClimatologyUserDefined object with the scaled values above and used that instead,
what is better about what we have done?  The primary advantage is that we do not need to know the configuration ahead
of time.  If we wanted to make a UserDefined object from the beginning we would need to know what latitude/longitude/mjd
to use for our values, and if we wanted to change them later we would need to remake the object.  Another advantage
is that we can change things in our climatology relatively easy.  If we wanted to add a method to change the scaling factor
we could do that very easily.  If we wanted to change the scaling factor of the UserDefined climatology we would have
to remake the object, and reset its reference in other places such as the atmosphere class.  Writing these kinds of
objects allows easy integration with the core of the <cite>sasktran</cite> package.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="weighting_functions.html" class="btn btn-neutral float-left" title="Weighting Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="experimental.html" class="btn btn-neutral float-right" title="Experimental Features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ARG University of Saskatchewan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>